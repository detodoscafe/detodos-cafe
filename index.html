<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>De Todos Caf√© - Men√∫ Digital & Pedidos</title>

  <meta name="description" content="Men√∫ digital de De Todos Caf√©. Pedidos por WhatsApp: Caf√©, limonadas granizadas, sodas, granizados y combos. Delivery disponible.">
  <meta name="keywords" content="caf√©, men√∫ digital, pedidos WhatsApp, limonadas, granizados, delivery, comida r√°pida, bebidas">
  <meta name="author" content="De Todos Caf√©">

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òï</text></svg>">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --cafe-oscuro:#3b1f0f; --cafe-medio:#8B4513; --cafe-claro:#D2691E;
      --whatsapp:#25D366; --texto:#2C1810; --acento:#FF6B35; --border:#E8D9C5;
      --bg:#faf7f2;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      font-family:'Inter','Segoe UI',sans-serif;
      background:linear-gradient(135deg,#f7f3ef 0%,#f0e6d6 100%);
      color:var(--texto); line-height:1.6; min-height:100vh;
      padding-bottom:80px; /* Espacio para bot√≥n flotante */
    }

    .header{
      background:linear-gradient(to right,var(--cafe-oscuro),var(--cafe-medio));
      color:#fff; text-align:center; padding:1.2rem 1rem;
      position:sticky; top:0; z-index:1000;
      box-shadow:0 4px 12px rgba(59,31,15,.2);
    }
    .logo{
      font-family:'Poppins',sans-serif; font-size:1.8rem; font-weight:700;
      display:flex; align-items:center; justify-content:center; gap:0.8rem;
      margin-bottom:0.3rem;
    }
    .logo i{color:var(--cafe-claro)}
    .subtitle{font-size:0.9rem;opacity:.9}

    .container{
      max-width:1400px; margin:0 auto; padding:1.5rem 1rem;
    }

    .productos{display:flex;flex-direction:column;gap:1.5rem}

    .categoria{
      background:#fff; border-radius:12px; padding:1.2rem;
      box-shadow:0 3px 10px rgba(0,0,0,.06);
      border-left:4px solid var(--cafe-claro);
    }
    .titulo-categoria{
      font-family:'Poppins',sans-serif; font-size:1.3rem; color:var(--cafe-oscuro);
      margin-bottom:1rem; padding-bottom:0.6rem; border-bottom:2px solid var(--border);
      display:flex;align-items:center;gap:.6rem;
    }
    .titulo-categoria i{color:var(--cafe-claro)}

    .grid-productos{
      display:grid; grid-template-columns:repeat(2, 1fr);
      gap:0.8rem;
    }
    @media(min-width:768px){.grid-productos{grid-template-columns:repeat(3, 1fr)}}
    @media(min-width:1024px){.grid-productos{grid-template-columns:repeat(4, 1fr)}}

    .producto{
      background:var(--bg); border-radius:10px; padding:0.9rem;
      border:1px solid var(--border); transition:all .25s ease;
      display:flex; flex-direction:column; height:100%;
    }
    .producto:hover{transform:translateY(-2px); box-shadow:0 5px 12px rgba(0,0,0,.08)}
    .nombre-producto{
      font-weight:800;font-size:0.95rem;margin-bottom:0.3rem;color:var(--cafe-oscuro);
      min-height:2.2rem; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    }
    .precio{font-weight:900;font-size:1.15rem;color:var(--acento);margin:0.5rem 0 0.7rem 0}
    
    .btn-agregar{
      width:100%;
      background:linear-gradient(to right,var(--cafe-medio),var(--cafe-claro));
      color:#fff;border:none;padding:0.7rem;border-radius:10px;
      font-weight:900;font-size:0.9rem;cursor:pointer;
      display:flex;align-items:center;justify-content:center;gap:.5rem;
      transition:all .25s; margin-top:auto;
    }
    .btn-agregar:hover{transform:translateY(-1px);box-shadow:0 4px 10px rgba(139,69,19,.25)}

    /* BOT√ìN WHATSAPP FLOTANTE */
    .whatsapp-flotante {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
    }

    .btn-whatsapp-flotante {
      background: linear-gradient(to right, var(--whatsapp), #1da851);
      color: #fff;
      border: none;
      padding: 1rem 1.5rem;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 900;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      transition: all 0.3s;
      box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
      min-width: 220px;
      position: relative;
      animation: pulse 2s infinite;
    }

    .btn-whatsapp-flotante:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
    }

    .btn-whatsapp-flotante:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      animation: none;
    }

    .badge-carrito-flotante {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--acento);
      color: #fff;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 900;
      border: 2px solid #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(37, 211, 102, 0); }
      100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
    }

    /* CARRITO FLOTANTE */
    .carrito-flotante {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 350px;
      max-height: 500px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      z-index: 9998;
      overflow: hidden;
      display: none; /* Inicialmente oculto */
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .carrito-flotante.abierto {
      display: flex;
      flex-direction: column;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .cabecera-carrito-flotante {
      background: linear-gradient(to right, var(--cafe-oscuro), var(--cafe-medio));
      color: #fff;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cabecera-carrito-flotante h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .badge-carrito-cabecera {
      background: var(--acento);
      color: #fff;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 900;
    }

    .btn-cerrar-carrito {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 0.4rem 0.8rem;
      border-radius: 10px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.25s;
    }

    .btn-cerrar-carrito:hover {
      background: rgba(255,255,255,0.1);
    }

    .contenido-carrito-flotante {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .items-carrito-flotante {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .item-carrito-flotante {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.8rem;
      padding: 0.7rem;
      margin-bottom: 0.6rem;
      background: var(--bg);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .info-item-flotante {
      flex: 1;
    }

    .nombre-item-flotante {
      font-weight: 900;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }

    .meta-item-flotante {
      font-size: 0.85rem;
      color: #666;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .qty-row-flotante {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.3rem;
    }

    .btn-qty-flotante {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.8rem;
    }

    .btn-qty-flotante:hover {
      border-color: var(--cafe-claro);
    }

    .qty-flotante {
      min-width: 20px;
      text-align: center;
      font-weight: 900;
      color: var(--cafe-oscuro);
    }

    .total-item-flotante {
      font-weight: 900;
      color: var(--acento);
      font-size: 0.95rem;
    }

    .btn-x-flotante {
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0.2rem 0.5rem;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .btn-x-flotante:hover {
      border-color: #fcc;
      background: #fee;
      color: #c00;
    }

    .total-pedido-flotante {
      border-top: 2px solid var(--border);
      padding-top: 0.9rem;
      margin-bottom: 0.9rem;
    }

    .fila-total-flotante {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .monto-total-flotante {
      font-weight: 900;
      font-size: 1.25rem;
      color: var(--cafe-oscuro);
    }

    .opciones-carrito-flotante {
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 0.9rem;
      margin-bottom: 1rem;
      background: #fffdfb;
    }

    .titulo-bloque-flotante {
      font-weight: 900;
      font-size: 0.95rem;
      color: var(--cafe-oscuro);
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.6rem;
    }

    .fila-opciones-flotante {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin: 0.5rem 0 0.7rem 0;
    }

    .label-mini-flotante {
      font-size: 0.8rem;
      color: #666;
      font-weight: 700;
    }

    select.flotante, input.flotante {
      width: 100%;
      padding: 0.6rem 0.7rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
    }

    .mini-ayuda-flotante {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.3rem;
    }

    .mensaje-vacio-flotante {
      text-align: center;
      padding: 1.5rem;
      color: #999;
    }

    .mensaje-vacio-flotante i {
      font-size: 2.5rem;
      margin-bottom: 0.8rem;
      opacity: 0.3;
    }

    /* Overlay para cerrar carrito */
    .overlay-carrito {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9997;
      display: none;
    }

    .overlay-carrito.mostrar {
      display: block;
    }

    .items-carrito-flotante::-webkit-scrollbar {
      width: 5px;
    }

    .items-carrito-flotante::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .items-carrito-flotante::-webkit-scrollbar-thumb {
      background: var(--cafe-claro);
      border-radius: 3px;
    }

    .footer{
      background:linear-gradient(to right,var(--cafe-oscuro),var(--cafe-medio));
      color:#fff;padding:1.5rem 1rem;margin-top:2.5rem;
    }
    .contenido-footer{max-width:1200px;margin:0 auto;text-align:center}
    .contacto{font-size:1rem;margin-bottom:.6rem;font-weight:900}
    .dirlocal{opacity:.9;margin-bottom:.6rem;font-size:0.9rem}
    .horario{font-style:italic;margin-bottom:0.9rem;opacity:.9;font-size:0.9rem}
    .creditos{font-size:0.85rem;opacity:.8;margin-top:0.9rem}

    @media(max-width:768px){
      .logo{font-size:1.4rem}
      .container{padding:1rem}
      .grid-productos{grid-template-columns:repeat(2, 1fr)}
      .carrito-flotante {
        width: calc(100% - 40px);
        max-height: 70vh;
        bottom: 90px;
      }
      .btn-whatsapp-flotante {
        min-width: 180px;
        padding: 0.9rem 1.2rem;
        font-size: 0.9rem;
      }
    }
    @media(max-width:480px){
      .grid-productos{grid-template-columns:1fr}
      .producto{padding:0.8rem}
      .btn-whatsapp-flotante {
        min-width: 150px;
        padding: 0.8rem 1rem;
        font-size: 0.85rem;
      }
    }

    @media(min-width:1024px){
      .whatsapp-flotante {
        bottom: 30px;
        right: 30px;
      }
      .carrito-flotante {
        bottom: 100px;
        right: 30px;
      }
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="logo">
      <i class="fas fa-coffee"></i>
      <span>De Todos Caf√©</span>
    </div>
    <p class="subtitle">Men√∫ Digital & Pedidos por WhatsApp</p>
  </header>

  <main class="container">
    <section class="productos" id="productos"></section>
  </main>

  <!-- Overlay para cerrar carrito -->
  <div class="overlay-carrito" id="overlayCarrito"></div>

  <!-- Carrito flotante -->
  <div class="carrito-flotante" id="carritoFlotante">
    <div class="cabecera-carrito-flotante">
      <h3>
        <i class="fas fa-shopping-cart"></i>
        Tu Pedido
        <span class="badge-carrito-cabecera" id="badgeCarritoFlotante">0</span>
      </h3>
      <button class="btn-cerrar-carrito" id="btnCerrarCarrito">
        <i class="fas fa-times"></i> Cerrar
      </button>
    </div>

    <div class="contenido-carrito-flotante">
      <div class="opciones-carrito-flotante">
        <div class="titulo-bloque-flotante">
          <i class="fas fa-sliders"></i> Datos del pedido
        </div>

        <div class="fila-opciones-flotante">
          <div class="label-mini-flotante">Tipo de pedido</div>
          <select id="tipoPedidoFlotante" class="flotante">
            <option value="domicilio">Domicilio</option>
            <option value="para_llevar">Para llevar</option>
            <option value="consumir_local">Consumir en el local</option>
          </select>
          <div class="mini-ayuda-flotante" id="ayudaEmpaqueFlotante">
            <i class="fas fa-info-circle"></i> Para llevar / Domicilio: se suma $1.000 por empaque.
          </div>
        </div>

        <div class="fila-opciones-flotante" id="filaDireccionFlotante" style="display:block;">
          <div class="label-mini-flotante">Direcci√≥n (solo si es domicilio)</div>
          <input id="direccionEntregaFlotante" class="flotante" type="text" placeholder="Ej: Calle 12 #34-56, Barrio..." />
        </div>

        <div class="fila-opciones-flotante">
          <div class="label-mini-flotante">Forma de pago</div>
          <select id="formaPagoFlotante" class="flotante">
            <option value="nequi">Nequi</option>
            <option value="efectivo">Efectivo</option>
          </select>
          <div class="mini-ayuda-flotante" id="detallePagoFlotante">
            <i class="fas fa-money-bill-wave"></i>
            Nequi: 3222096301 ‚Äî Vigny Valencia
          </div>
        </div>

        <div class="fila-opciones-flotante">
          <div class="label-mini-flotante">Nombre de quien recoge</div>
          <input id="nombreClienteFlotante" class="flotante" type="text" placeholder="Ej: Juan P√©rez" />
        </div>

        <div class="mini-ayuda-flotante">
          <i class="fas fa-clock"></i> Tiempo estimado: <b>30 minutos</b>.
        </div>
      </div>

      <!-- ITEMS -->
      <div class="items-carrito-flotante" id="itemsCarritoFlotante">
        <div class="mensaje-vacio-flotante">
          <i class="fas fa-shopping-cart"></i>
          <p>Tu carrito est√° vac√≠o</p>
          <p>Agrega productos para comenzar</p>
        </div>
      </div>

      <!-- TOTALES -->
      <div class="total-pedido-flotante">
        <div class="fila-total-flotante">
          <span>Subtotal:</span>
          <span id="subtotalFlotante">$0</span>
        </div>
        <div class="fila-total-flotante">
          <span>Env√≠o:</span>
          <span id="envioFlotante">$0</span>
        </div>
        <div class="fila-total-flotante">
          <span>Empaque:</span>
          <span id="empaqueFlotante">$0</span>
        </div>
        <div class="fila-total-flotante monto-total-flotante">
          <span>Total:</span>
          <span id="totalFlotante">$0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n WhatsApp flotante -->
  <div class="whatsapp-flotante">
    <button class="btn-whatsapp-flotante" id="btnWhatsappFlotante" disabled>
      <i class="fab fa-whatsapp"></i>
      Pedir por WhatsApp
      <span class="badge-carrito-flotante" id="badgeWhatsapp">0</span>
    </button>
  </div>

  <footer class="footer">
    <div class="contenido-footer">
      <p class="contacto">
        <i class="fas fa-phone"></i> 
        Pedidos: <a href="tel:+573222096301" style="color:white;text-decoration:underline">322 2096301</a>
      </p>
      <p class="dirlocal">
        <i class="fas fa-location-dot"></i> 
        <span id="localDireccionFooter">Ubicaci√≥n variable - Consultar al hacer pedido</span>
      </p>
      <p class="horario"><i class="fas fa-clock"></i> Lunes a Domingo: 8:00 AM - 8:00 PM</p>
      <p class="creditos">¬© 2026 De Todos Caf√©. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script>
    // ==================== CONFIGURACI√ìN ====================
    const CONFIG = {
      telefonoWhatsApp: "573222096301",
      tiempoEstimadoMin: 30,
      costoEnvioBase: 3000,
      envioGratisDesde: 25000,
      costoEmpaque: 1000,
      nequi: { numero: "3222096301", titular: "Vigny Valencia" },
      localDireccion: "üìç Ubicaci√≥n variable - Consultar disponibilidad al hacer pedido"
    };

    // ==================== MEN√ö (tu carta completa) ====================
    const menuData = {
      categorias: [
        {
          id: "limonadas",
          nombre: "Limonadas Granizadas",
          icono: "glass-whiskey",
          productos: [
            { id: 1, nombre: "Mango sal pimienta", precio: 10000 },
            { id: 2, nombre: "Mango + hierbabuena", precio: 11000 },
            { id: 3, nombre: "Mango + pi√±a", precio: 11000 },
            { id: 4, nombre: "Mango + maracuy√°", precio: 11000 },
            { id: 5, nombre: "Mango + lulo", precio: 12000 },
            { id: 6, nombre: "Mango + mandarina", precio: 12000 },
            { id: 7, nombre: "Mango + naranja", precio: 12000 },
            { id: 8, nombre: "Mango + mandarina + manzana", precio: 13000 },
            { id: 9, nombre: "Mango + pi√±a + maracuy√°", precio: 13000 },
            { id: 10, nombre: "Maracuy√°", precio: 10000 },
            { id: 11, nombre: "Maracuy√° + hierbabuena", precio: 11000 },
            { id: 12, nombre: "Lulo", precio: 11000 },
            { id: 13, nombre: "Lulo + hierbabuena", precio: 12000 },
            { id: 14, nombre: "Cereza", precio: 11000 },
            { id: 15, nombre: "Cereza + hierbabuena", precio: 12000 },
            { id: 16, nombre: "Fresa + lim√≥n", precio: 11000 },
            { id: 17, nombre: "Lim√≥n + hierbabuena", precio: 7000 },
            { id: 18, nombre: "Manzana", precio: 10000 },
            { id: 19, nombre: "Manzana + hierbabuena", precio: 11000 },
            { id: 20, nombre: "Pi√±a", precio: 10000 },
            { id: 21, nombre: "Pi√±a + hierbabuena", precio: 11000 },
            { id: 22, nombre: "Mora + fresas", precio: 12000 },
            { id: 23, nombre: "Mora", precio: 10000 },
            { id: 24, nombre: "Uva", precio: 10000 },
            { id: 25, nombre: "Naranja", precio: 10000 },
            { id: 26, nombre: "Naranja + hierbabuena", precio: 11000 },
            { id: 27, nombre: "Mandarina", precio: 11000 },
            { id: 28, nombre: "Coco", precio: 13000 }
          ]
        },
        {
          id: "sodas",
          nombre: "Sodas",
          icono: "glass-cheers",
          productos: [
            { id: 29, nombre: "Lim√≥n + sal", precio: 6000 },
            { id: 30, nombre: "Soda michelada de Mango", precio: 11000 },
            { id: 31, nombre: "Frutos amarillos", precio: 11000 },
            { id: 32, nombre: "Frutos rojos", precio: 11000 },
            { id: 33, nombre: "Cereza hierbabuena", precio: 11000 },
            { id: 34, nombre: "Manzana verde", precio: 11000 },
            { id: 35, nombre: "Michelada de ginger", precio: 11000 }
          ]
        },
        {
          id: "granizados",
          nombre: "Granizados",
          icono: "snowflake",
          productos: [
            { id: 36, nombre: "Milo", precio: 10000 },
            { id: 37, nombre: "Milo nevado", precio: 11000 },
            { id: 38, nombre: "Oreo", precio: 11000 },
            { id: 39, nombre: "Oreo nevado", precio: 12000 },
            { id: 40, nombre: "Caf√©", precio: 10000 },
            { id: 41, nombre: "Caf√© nevado", precio: 11000 },
            { id: 42, nombre: "Frapuchino", precio: 12000 },
            { id: 43, nombre: "Frapuchino nevado", precio: 13000 },
            { id: 44, nombre: "Frapuchino whisky", precio: 14000 }
          ]
        },
        {
          id: "cremosos",
          nombre: "Cremosos",
          icono: "ice-cream",
          productos: [
            { id: 45, nombre: "Cremoso maracuy√°", precio: 11000 },
            { id: 46, nombre: "Cremoso mora", precio: 11000 },
            { id: 47, nombre: "Cremoso uva", precio: 11000 },
            { id: 48, nombre: "Cremoso fresa", precio: 11000 },
            { id: 49, nombre: "Cremoso frutos rojos", precio: 12000 }
          ]
        },
        {
          id: "bebidas_calientes",
          nombre: "Bebidas calientes",
          icono: "mug-hot",
          productos: [
            { id: 50, nombre: "Caf√© de la casa", precio: 1500 },
            { id: 51, nombre: "Americano", precio: 3000 },
            { id: 52, nombre: "Caf√© en prensa", precio: 6000 },
            { id: 53, nombre: "Expreso", precio: 3000 },
            { id: 54, nombre: "Carajillo", precio: 5000 },
            { id: 55, nombre: "Perico", precio: 1500 },
            { id: 56, nombre: "Caf√© con leche", precio: 2000 },
            { id: 57, nombre: "Espumoso", precio: 7000 },
            { id: 58, nombre: "Caf√© bomb√≥n", precio: 7000 },
            { id: 59, nombre: "Capuchino whisky", precio: 7000 },
            { id: 60, nombre: "Capuchino oreo", precio: 7000 },
            { id: 61, nombre: "Capuchino masmelo", precio: 7000 },
            { id: 62, nombre: "Milo caliente", precio: 6000 }
          ]
        },
        {
          id: "infusiones",
          nombre: "Infusiones y arom√°ticas",
          icono: "leaf",
          productos: [
            { id: 63, nombre: "Arom√°tica de panela", precio: 2000 },
            { id: 64, nombre: "Infusi√≥n de hierbabuena", precio: 1500 },
            { id: 65, nombre: "Infusi√≥n de flor de Jamaica", precio: 2000 },
            { id: 66, nombre: "Arom√°tica de frutos rojos", precio: 5000 },
            { id: 67, nombre: "Arom√°tica de frutas amarilla", precio: 5000 }
          ]
        },
        {
          id: "combos",
          nombre: "Combos especiales",
          icono: "gift",
          productos: [
            { id: 68, nombre: "Agua panela + pan + roscas + queso", precio: 10000 },
            { id: 69, nombre: "Milo + pan + roscas + queso", precio: 11000 },
            { id: 70, nombre: "Migao de chocolate", precio: 11000 },
            { id: 71, nombre: "Migao de milo", precio: 12000 }
          ]
        }
      ]
    };

    // ==================== UTILIDADES ====================
    const money = (n) => `$${Number(n || 0).toLocaleString("es-CO")}`;
    const normalizeSpaces = (s) => (s || "").replace(/\s+/g, " ").trim();

    // ==================== CARRITO FLOTANTE ====================
    class CarritoFlotante {
      constructor(){
        this.items = new Map();
        this.subtotal = 0;
        this.envio = 0;
        this.empaque = 0;
        this.total = 0;
        this.totalItems = 0;
        this.storageKey = "carritoDeTodosCafe_prod";
        this.carritoAbierto = false;

        this.cacheDom();
        this.init();
      }

      cacheDom(){
        // Elementos del carrito flotante
        this.carritoFlotante = document.getElementById("carritoFlotante");
        this.overlayCarrito = document.getElementById("overlayCarrito");
        this.btnCerrarCarrito = document.getElementById("btnCerrarCarrito");
        this.itemsCarritoFlotante = document.getElementById("itemsCarritoFlotante");
        this.badgeCarritoFlotante = document.getElementById("badgeCarritoFlotante");
        this.badgeWhatsapp = document.getElementById("badgeWhatsapp");
        this.subtotalFlotante = document.getElementById("subtotalFlotante");
        this.envioFlotante = document.getElementById("envioFlotante");
        this.empaqueFlotante = document.getElementById("empaqueFlotante");
        this.totalFlotante = document.getElementById("totalFlotante");
        this.btnWhatsappFlotante = document.getElementById("btnWhatsappFlotante");
        
        // Opciones del carrito flotante
        this.selTipoFlotante = document.getElementById("tipoPedidoFlotante");
        this.selPagoFlotante = document.getElementById("formaPagoFlotante");
        this.inpNombreFlotante = document.getElementById("nombreClienteFlotante");
        this.inpDireccionFlotante = document.getElementById("direccionEntregaFlotante");
        this.filaDireccionFlotante = document.getElementById("filaDireccionFlotante");
        this.detallePagoFlotante = document.getElementById("detallePagoFlotante");
        
        // Productos
        this.elProductos = document.getElementById("productos");
        
        // Footer
        this.footerDir = document.getElementById("localDireccionFooter");
      }

      init(){
        this.footerDir.textContent = CONFIG.localDireccion;

        this.loadFromStorage();
        this.renderMenu();
        this.attachEventListeners();
        this.updateUI();

        // Instrucciones solo una vez
        setTimeout(() => {
          if (!localStorage.getItem("instruccionesVistasDeTodosCafe")){
            alert("üí° C√≥mo pedir:\n1) Agrega productos\n2) Toca el bot√≥n verde para ver tu pedido\n3) Completa los datos\n4) ¬°Toca 'Pedir por WhatsApp'!\n\n¬°Listo!");
            localStorage.setItem("instruccionesVistasDeTodosCafe", "true");
          }
        }, 700);
      }

      attachEventListeners(){
        // Abrir carrito al hacer clic en el bot√≥n de WhatsApp
        this.btnWhatsappFlotante.addEventListener("click", (e) => {
          e.stopPropagation();
          if (this.totalItems === 0) {
            // Si no hay items, mostrar el carrito vac√≠o
            this.abrirCarrito();
          } else {
            // Si hay items, verificar datos antes de enviar
            this.validarYEnviarPedido();
          }
        });

        // Cerrar carrito
        this.btnCerrarCarrito.addEventListener("click", () => this.cerrarCarrito());
        this.overlayCarrito.addEventListener("click", () => this.cerrarCarrito());

        // Tipo de pedido flotante
        this.selTipoFlotante.addEventListener("change", () => {
          this.applyTipoPedidoUI();
        });

        // Forma de pago flotante
        this.selPagoFlotante.addEventListener("change", () => {
          this.applyPagoUI();
        });

        // Inputs flotantes
        this.inpNombreFlotante.addEventListener("input", () => this.updateUI(false));
        this.inpDireccionFlotante.addEventListener("input", () => this.updateUI(false));

        // Delegaci√≥n: botones del men√∫ (agregar)
        this.elProductos.addEventListener("click", (e) => {
          const btn = e.target.closest("button");
          if (!btn) return;
          
          if (btn.classList.contains('btn-agregar')) {
            const id = Number(btn.dataset.id);
            const prod = this.findProductById(id);
            if (!prod) return;
            this.addItem(prod.id, prod.nombre, prod.precio, 1);
            return;
          }
        });

        // Delegaci√≥n: carrito flotante (+/-/x)
        this.itemsCarritoFlotante.addEventListener("click", (e) => {
          const btn = e.target.closest("button[data-cart]");
          if (!btn) return;
          const action = btn.dataset.cart;
          const id = Number(btn.dataset.id);
          if (!id) return;

          if (action === "inc") this.changeQty(id, 1);
          if (action === "dec") this.changeQty(id, -1);
          if (action === "del") this.removeItem(id);
        });

        // Estado inicial de UI
        this.applyTipoPedidoUI();
        this.applyPagoUI();
      }

      validarYEnviarPedido(){
        // Validaci√≥n de nombre
        const nombre = normalizeSpaces(this.inpNombreFlotante.value);
        if (!nombre) {
          alert("Por favor escribe tu nombre en 'Datos del pedido'");
          this.abrirCarrito();
          this.inpNombreFlotante.focus();
          return;
        }
        
        // Validaci√≥n de direcci√≥n para domicilio
        if (this.selTipoFlotante.value === "domicilio") {
          const direccion = normalizeSpaces(this.inpDireccionFlotante.value);
          if (!direccion) {
            alert("Para domicilio, por favor escribe tu direcci√≥n");
            this.abrirCarrito();
            this.inpDireccionFlotante.focus();
            return;
          }
        }
        
        const msg = this.buildWhatsAppMessage();
        const url = `https://wa.me/${CONFIG.telefonoWhatsApp}?text=${encodeURIComponent(msg)}`;
        window.open(url, "_blank");
      }

      applyTipoPedidoUI(){
        const t = this.selTipoFlotante.value;
        // Direcci√≥n solo si domicilio
        this.filaDireccionFlotante.style.display = (t === "domicilio") ? "block" : "none";
        if (t !== "domicilio") this.inpDireccionFlotante.value = "";

        // Actualizar totales inmediatamente
        this.updateTotals();
        this.updateUI(false);
      }

      applyPagoUI(){
        const p = this.selPagoFlotante.value;
        if (p === "nequi"){
          this.detallePagoFlotante.innerHTML = `<i class="fas fa-money-bill-wave"></i> Nequi: <b>${CONFIG.nequi.numero}</b> ‚Äî ${CONFIG.nequi.titular}`;
        } else {
          this.detallePagoFlotante.innerHTML = `<i class="fas fa-money-bill-wave"></i> Pago en efectivo (al recibir / en caja)`;
        }
      }

      abrirCarrito(){
        this.carritoFlotante.classList.add('abierto');
        this.overlayCarrito.classList.add('mostrar');
        this.carritoAbierto = true;
      }

      cerrarCarrito(){
        this.carritoFlotante.classList.remove('abierto');
        this.overlayCarrito.classList.remove('mostrar');
        this.carritoAbierto = false;
      }

      toggleCarrito(){
        if (this.carritoAbierto) {
          this.cerrarCarrito();
        } else {
          this.abrirCarrito();
        }
      }

      renderMenu(){
        this.elProductos.innerHTML = "";
        menuData.categorias.forEach(cat => {
          const wrap = document.createElement("div");
          wrap.className = "categoria";
          wrap.innerHTML = `
            <h2 class="titulo-categoria">
              <i class="fas fa-${cat.icono}"></i>
              ${cat.nombre}
            </h2>
            <div class="grid-productos">
              ${this.renderProductos(cat)}
            </div>
          `;
          this.elProductos.appendChild(wrap);
        });
      }

      renderProductos(cat){
        return cat.productos.map(p => `
          <div class="producto">
            <div class="nombre-producto">${p.nombre}</div>
            <div class="precio">${money(p.precio)}</div>
            <button class="btn-agregar" data-id="${p.id}">
              <i class="fas fa-cart-plus"></i> Agregar
            </button>
          </div>
        `).join("");
      }

      // ------- Carrito operations -------
      addItem(id, nombre, precio, qty){
        const current = this.items.get(id);
        if (current){
          current.cantidad += qty;
          this.items.set(id, current);
        } else {
          this.items.set(id, { id, nombre, precio, cantidad: qty });
        }
        this.saveToStorage();
        this.updateUI();
        this.toast("‚úÖ Producto agregado");
        
        // Abrir el carrito autom√°ticamente al agregar un producto
        if (!this.carritoAbierto && this.totalItems === 1) {
          setTimeout(() => this.abrirCarrito(), 300);
        }
      }

      changeQty(id, delta){
        const it = this.items.get(id);
        if (!it) return;
        it.cantidad += delta;
        if (it.cantidad <= 0) this.items.delete(id);
        else this.items.set(id, it);
        this.saveToStorage();
        this.updateUI();
      }

      removeItem(id){
        if (!this.items.has(id)) return;
        this.items.delete(id);
        this.saveToStorage();
        this.updateUI();
        this.toast("üóëÔ∏è Producto eliminado");
      }

      // ------- Totals -------
      updateTotals(){
        this.subtotal = 0;
        this.totalItems = 0;

        this.items.forEach(it => {
          this.subtotal += (it.precio * it.cantidad);
          this.totalItems += it.cantidad;
        });

        // Env√≠o (solo si es domicilio)
        const tipo = this.selTipoFlotante.value;
        if (tipo === "domicilio"){
          this.envio = (this.subtotal >= CONFIG.envioGratisDesde) ? 0 : CONFIG.costoEnvioBase;
        } else {
          this.envio = 0;
        }

        // Empaque (+$1.000) si es domicilio o para llevar
        if (tipo === "domicilio" || tipo === "para_llevar"){
          this.empaque = (this.totalItems > 0) ? CONFIG.costoEmpaque : 0;
        } else {
          this.empaque = 0;
        }

        this.total = this.subtotal + this.envio + this.empaque;
      }

      // ------- UI -------
      updateUI(reRenderCart = true){
        this.updateTotals();

        // Actualizar badges
        this.badgeCarritoFlotante.textContent = String(this.totalItems);
        this.badgeWhatsapp.textContent = String(this.totalItems);
        
        // Actualizar totales en carrito flotante
        this.subtotalFlotante.textContent = money(this.subtotal);
        this.envioFlotante.textContent = this.envio === 0 ? "Gratis" : money(this.envio);
        this.empaqueFlotante.textContent = money(this.empaque);
        this.totalFlotante.textContent = money(this.total);

        // Habilitar bot√≥n WhatsApp solo si hay items
        this.btnWhatsappFlotante.disabled = (this.totalItems === 0);

        // Render carrito flotante
        if (reRenderCart) this.renderCart();

        // T√≠tulo din√°mico
        document.title = `De Todos Caf√© ${this.totalItems ? `(${this.totalItems})` : ""} - Men√∫ Digital`;
      }

      renderCart(){
        if (this.items.size === 0){
          this.itemsCarritoFlotante.innerHTML = `
            <div class="mensaje-vacio-flotante">
              <i class="fas fa-shopping-cart"></i>
              <p>Tu carrito est√° vac√≠o</p>
              <p>Agrega productos para comenzar</p>
            </div>
          `;
          return;
        }

        let html = "";
        this.items.forEach(it => {
          const totalIt = it.precio * it.cantidad;
          html += `
            <div class="item-carrito-flotante">
              <div class="info-item-flotante">
                <div class="nombre-item-flotante">${it.nombre}</div>
                <div class="meta-item-flotante">
                  <div>Unitario: <b>${money(it.precio)}</b></div>
                  <div class="qty-row-flotante">
                    <button class="btn-qty-flotante" data-cart="dec" data-id="${it.id}">-</button>
                    <span class="qty-flotante">${it.cantidad}</span>
                    <button class="btn-qty-flotante" data-cart="inc" data-id="${it.id}">+</button>
                  </div>
                </div>
              </div>
              <div style="display:flex;flex-direction:column;align-items:flex-end;gap:.4rem;">
                <div class="total-item-flotante">${money(totalIt)}</div>
                <button class="btn-x-flotante" data-cart="del" data-id="${it.id}">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          `;
        });

        this.itemsCarritoFlotante.innerHTML = html;
      }

      // ------- WhatsApp Message (COMPLETA) -------
      buildWhatsAppMessage(){
        const tipo = this.selTipoFlotante.value;
        const pago = this.selPagoFlotante.value;
        const nombre = normalizeSpaces(this.inpNombreFlotante.value);
        const direccion = normalizeSpaces(this.inpDireccionFlotante.value);

        const tipoTxt =
          tipo === "domicilio" ? "Domicilio" :
          tipo === "para_llevar" ? "Para llevar" :
          "Consumir en el local";

        const pagoTxt =
          pago === "nequi" ? `Nequi (${CONFIG.nequi.numero} - ${CONFIG.nequi.titular})` :
          "Efectivo";

        let msg = `¬°Hola! Quisiera hacer un pedido en *De Todos Caf√©* ‚òïÔ∏è\n\n`;
        msg += `üßæ *DATOS DEL PEDIDO*\n`;
        msg += `‚Ä¢ Tipo: *${tipoTxt}*\n`;
        msg += `‚Ä¢ Forma de pago: *${pagoTxt}*\n`;
        msg += `‚Ä¢ Nombre: *${nombre}*\n`;

        if (tipo === "domicilio"){
          msg += `‚Ä¢ Direcci√≥n: *${direccion}*\n`;
        }

        msg += `‚Ä¢ Tiempo estimado: *${CONFIG.tiempoEstimadoMin} min*\n`;
        msg += `‚Ä¢ ${CONFIG.localDireccion}\n`;
        msg += `\n`;

        msg += `üìã *MI PEDIDO*\n`;
        let i = 1;
        this.items.forEach(it => {
          const lineTotal = it.precio * it.cantidad;
          msg += `${i}. ${it.nombre}\n`;
          msg += `   Cantidad: ${it.cantidad}\n`;
          msg += `   Unitario: ${money(it.precio)}\n`;
          msg += `   Subtotal: ${money(lineTotal)}\n\n`;
          i++;
        });

        msg += `‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n`;
        msg += `üí∞ Subtotal: ${money(this.subtotal)}\n`;
        msg += `üöö Env√≠o: ${this.envio === 0 ? "Gratis" : money(this.envio)}\n`;
        msg += `üß¥ Empaque: ${money(this.empaque)}\n`;
        msg += `‚úÖ Total a pagar: *${money(this.total)}*\n`;
        msg += `‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n\n`;
        msg += `¬øMe confirmas disponibilidad y hora aproximada? ¬°Gracias! üôå`;

        return msg;
      }

      // ------- Storage -------
      saveToStorage(){
        const arr = Array.from(this.items.values());
        localStorage.setItem(this.storageKey, JSON.stringify(arr));
      }

      loadFromStorage(){
        try{
          const raw = localStorage.getItem(this.storageKey);
          if (!raw) return;
          const arr = JSON.parse(raw);
          if (!Array.isArray(arr)) return;
          arr.forEach(it => {
            if (it && it.id && it.nombre && typeof it.precio === "number" && typeof it.cantidad === "number"){
              this.items.set(Number(it.id), { ...it, id: Number(it.id) });
            }
          });
        }catch(e){
          console.error("Storage error:", e);
          localStorage.removeItem(this.storageKey);
        }
      }

      // ------- Helpers -------
      findProductById(id){
        for (const cat of menuData.categorias){
          const p = cat.productos?.find(x => x.id === id);
          if (p) return p;
        }
        return null;
      }

      toast(text){
        const el = document.createElement("div");
        el.style.cssText = `
          position: fixed;
          bottom: 120px;
          right: 20px;
          background: rgba(0, 100, 0, 0.9);
          color: white;
          padding: 10px 18px;
          border-radius: 8px;
          box-shadow: 0 3px 10px rgba(0,0,0,0.2);
          z-index: 10000;
          font-weight: 600;
          max-width: 300px;
          text-align: center;
          font-size: 0.9rem;
        `;
        el.textContent = text;
        document.body.appendChild(el);
        setTimeout(() => {
          el.style.opacity = "0";
          el.style.transition = "opacity 0.3s ease";
          setTimeout(() => el.remove(), 300);
        }, 1500);
      }
    }

    // ==================== INIT ====================
    let carrito;
    document.addEventListener("DOMContentLoaded", () => {
      carrito = new CarritoFlotante();
    });
  </script>
</body>
</html>